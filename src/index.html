<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="index.css">
    <script src="./assets/jquery-3.7.1.min.js"></script>
  </head>
  <body>
    <div class="body">
      <div class="searchBar">
        <img src="./assets/search.svg" class="searchIcon">
        <input autofocus type="text" name="search" id="search" class="search" placeholder="Search away...">
      </div>

      <div class="resultBox">

        <!-- <div class="result">
           <img src="./assets/google.png" class="resimg">
           <p>Search in Google for "firefox"</p>
        </div> -->

      </div>
    </div>
    <script>

      $(".resultBox").slideUp(); // Start with the result box closed
    
      // Handling Operations which do not need a result to be shown
      $("#search").on('keyup', (key) => {
        // When a query is submitted
        if(key.originalEvent.key === "Enter") {
          let text = $("#search").val(); // Get the query

          // If it is quit, then quit the app
          if(text.trim().toLowerCase() === "quit") {
            window.backend.quit();
          }
        }
      });

      // Whenever the search bar is being edited
      $("#search").on('input', ()=>{
        let text = $("#search").val(); // Get the text entered

        // If text is noe empty
        if(text.length > 0) {
          // Show the result box
          $(".resultBox").slideDown();
        }
        if(text.length == 0) {
          // Else close the result box
          $('.resultBox').slideUp();
        }

        // Clear all the results from the previous query
        $(".resultBox").empty();

        // Generate a new set of results

        // Launching an application
        let launch_app = generate_result("./assets/application.png", `Launch Program ${text}`);
        launch_app.addEventListener('click', () => {
          window.backend.launchApp(text);
        });
        // Check if the app is installed
        window.backend.checkInstalled(text).then((res) => {
          if(res) {
            $('.resultBox').append(launch_app);
          }
        });

        // google search
        let google_search = generate_result("./assets/google.png", `Search in google for ${text}`);
        google_search.addEventListener('click', () => {window.backend.webSearch(text); resClicked()});
        $(".resultBox").append(google_search);
      });

      // If the search loses focus, close the result box
      function resClicked() {
        $(".resultBox").slideUp();
        $("#search").val("");
      }

      // Generates results for queries
      function generate_result(icon, text) {
        let res = document.createElement('div');
        res.className = "result";

        let img = document.createElement('img');
        img.className = "resimg";
        img.src = icon;
        
        let p = document.createElement('p');
        p.innerHTML = text;

        res.appendChild(img);
        res.appendChild(p);

        return res;
      }
    </script>
  </body>
</html>
